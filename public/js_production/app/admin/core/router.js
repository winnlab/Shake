define(["canjs","underscore"],function(e,t){var n=e.Map.extend({modules:[],initModule:function(e,t){var n=this;n.checkModule(t)||require([e.path],function(r){if(!r)throw e.path?new Error("Please check constructor of "+e.path+".js"):new Error('Please check existing of module "'+e.name+'"');n.addModule(t),new r("#"+t),n.activateModule(t)})},checkModule:function(e){var n=t.find(this.modules,function(t){return t.id===e}),r=!t.isEmpty(n);return r&&this.activateModule(e),r},addModule:function(e){this.modules.push({id:e,active:!1})},activateModule:function(e){t.map(this.modules,function(t){t.attr("active",t.id===e)})}});return e.Control.extend({defaults:{viewpath:"../app/admin/core/views/"}},{init:function(r,i){this.Placeholder=new n;var s=e.view(this.options.viewpath+"route.stache",{modules:this.Placeholder.attr("modules")}),o=this;$(i.modulesContainer).html(s),t.each(i.routes,function(t){e.route(t.route,t.defaults?t.defaults:{})}),e.route.bindings.pushstate.root=i.base,e.route.ready(!1)},".module click":function(n,r){r.preventDefault();var i=this.options,s=n.attr("href").split(i.base)[1],o=e.route.deparam(s);try{if(!!t.isEmpty(o))throw new Error("There now such routing rule for '"+s+"', please check your configuration file");e.route.attr(o,!0)}catch(u){console.error(u)}},":module route":"routeChanged",":module/:id route":"routeChanged",":module/:id/:action/:entity_id route":"routeChanged",":module/:action/:entity_id route":"routeChanged",routeChanged:function(e){var n=this.options.modules,r=e.module,i=r+(e.id?"-"+e.id:"");module=t.find(n,function(e){return e.name===r});try{if(!module)throw new Error("There no such module '"+r+"', please check your configuration file");this.Placeholder.initModule(module,i)}catch(s){console.error(s)}}})});