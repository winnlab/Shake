define(["canjs","underscore","app/newPodcasts/newPodcast","app/newPodcasts/newPodcastsModel","core/appState","css!app/newPodcasts/css/newPodcasts"],function(e,t,n,r,i){var s=e.Map.extend({define:{viewState:{value:"list"}},reOrder:function(e,t){t=t||"position";var n=this.attr(e);n.sort(function(e,n){return e[t]>n[t]?1:e[t]<n[t]?-1:0})},toList:function(){e.route.attr({module:"newPodcasts",action:undefined,entity_id:undefined}),this.attr("viewState","list")},toEntity:function(t){e.route.attr({entity_id:t,action:"set",module:"newPodcasts"})}});return e.Control.extend({defaults:{viewpath:"app/newPodcasts/views/",newPodcastsModel:r}},{init:function(){var t=this,n=e.route.attr();viewModel=new s,viewModel.attr({newPodcasts:new r.List({})}),n.entity_id&&n.action&&(viewModel.attr("viewState","edit"),e.when(viewModel.attr("newPodcasts")).then(function(){t.setNewPodcast(n.entity_id,n.action)})),console.log(viewModel),t.element.html(e.view(t.options.viewpath+"index.stache",viewModel)),this.viewModel=viewModel},":module/:id route":function(e){var t=this.viewModel,n=t.attr("viewState");e.module==="newPodcasts"&&n!=="list"&&t.toList()},":module/:action/:entity_id route":function(e){e.module==="newPodcasts"&&this.setNewPodcast(e.entity_id,e.action)},".addNewPodcast click":function(e){this.viewModel.toEntity("0")},".editNewPodcast click":function(e){var t=e.parents(".newPodcast").data("newPodcast");this.viewModel.toEntity(t.attr("_id"))},setNewPodcast:function(e){this.viewModel.attr({id:Date.now(),viewState:"edit"});var i=this,s=i.element.find(".setNewPodcastWrap"),o=t.find(i.viewModel.attr("newPodcasts"),function(t){return t&&t.attr("_id")===e});new n(s,{newPodcast:o?o:new r})},".removeNewPodcast click":function(e){var t=e.parents(".newPodcast").data("newPodcast");confirm('Вы действительно хотите удалить анонс подкаста: "'+t.attr("name")+'"?')&&t.destroy().always(function(e,t,n){i.attr("notification",{status:t,msg:e.name+". "+n.responseJSON.message})})},"{newPodcastsModel} updated":function(){this.viewModel.reOrder("newPodcasts")},"{newPodcastsModel} created":function(e,t,n){var r=this,i=r.viewModel.attr("newPodcasts");i.push(n),this.viewModel.reOrder("newPodcasts")}})});