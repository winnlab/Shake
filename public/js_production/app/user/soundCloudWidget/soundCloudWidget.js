define(["canjs","underscore","core/appState","core/hub","soundcloud/sdk","soundcloud/api"],function(e,t,n,r){var i=e.Control.extend({defaults:{clientId:"36d9ee3197b18f8c51dbc9a24ef5cc70",userId:"/users/107070408",userPlaylistsLink:"/users/107070408/playlists",viewpath:"app/soundCloudWidget/"}},{init:function(){var e=this;e.playlists=null,e.widget=null,e.currentPlaylistIndex=null,e.podcast=n.attr("podcast")},initSoundCloudWidget:function(e,t,n){var r=this;SC.initialize({client_id:r.options.clientId}),r.getPlaylists(e,t,n)},getPlaylists:function(e,t,r){var i=this;SC.get(i.options.userPlaylistsLink,function(s){i.playlists=s,n.attr("podcast.playlists",s),t?i.playPlaylist(e,s):r()})},playPlaylist:function(e,t){var r=this;if(n.attr("podcast.currentPlaylist"))r.currentPlaylistIndex=r.podcast.attr("currentPlaylistSystemPosition"),r.initIframe(e,n.attr("podcast.currentPlaylist"),r.podcast.attr("currentPlaylistSystemPosition"));else{var i=Math.floor(Math.random()*(parseInt(t.length)-1));r.podcast.attr("currentPlaylistSystemPosition",i),r.currentPlaylistIndex=i,r.initIframe(e,t[i],i)}},displayPlaylists:function(e,t,n){var r=this;r.podcast.attr("currentPlaylist",t[n]),r.podcast.attr("currentPlaylistPosition",n+1),n-1>=0?(r.podcast.attr("prevPlaylist",t[n-1]),r.podcast.attr("prevPlaylistPosition",n)):(r.podcast.attr("prevPlaylist",t[t.length-1]),r.podcast.attr("prevPlaylistPosition",t.length)),n+1<=t.length-1?(r.podcast.attr("nextPlaylist",t[n+1]),r.podcast.attr("nextPlaylistPosition",n+2)):(r.podcast.attr("nextPlaylist",t[0]),r.podcast.attr("nextPlaylistPosition",1))},initIframe:function(t,n,r,i){var s=this,o=t.find("iframe");o.length>0&&(o.remove(),s.widget=null),t.html(e.view(s.options.viewpath+"iframe.stache",{width:"100%",height:"450",scrolling:"no",frameborder:"no",auto_play:!0,hide_related:"true",show_comments:"false",show_user:"false",show_reposts:"false",visual:"true",playlist_id:n.id})),s.displayPlaylists(t,s.playlists,r),s.initWidget()},initWidget:function(){var e=this;e.widget=SC.Widget(document.getElementById("soundcloud_widget")),e.widget.bind(SC.Widget.Events.PLAY,function(){e.trackStartedPlaying()}),e.widget.bind(SC.Widget.Events.PAUSE,function(){e.trackPaused()})},trackStartedPlaying:function(){var e=this;e.widget.getCurrentSound(function(t){e.podcast.attr("currentSound",t),e.podcast.attr("currentTitle",t.title),n.attr("paused",!0)})},trackPaused:function(){n.attr("paused",!1)},playNextPlaylist:function(e){var t=this;t.widget&&t.widget.pause(),t.podcast.attr("currentSound",null),t.podcast.attr("currentTitle",null),n.attr("paused",!1),t.currentPlaylistIndex+1<=t.playlists.length-1?t.currentPlaylistIndex++:t.currentPlaylistIndex=0,t.initIframe(e,t.playlists[t.currentPlaylistIndex],t.currentPlaylistIndex,!0)},playPrevPlaylist:function(e){var t=this;t.widget&&t.widget.pause(),t.podcast.attr("currentSound",null),t.podcast.attr("currentTitle",null),n.attr("paused",!1),t.currentPlaylistIndex-1>=0?t.currentPlaylistIndex--:t.currentPlaylistIndex=t.playlists.length-1,t.initIframe(e,t.playlists[t.podcast.attr("currentPlaylistPosition")],t.currentPlaylistIndex,!0)},togglePause:function(t){var n=this;n.widget?n.widget.toggle():e.trigger(r,"silentModule",["podcast","podcast"])},toggleMute:function(){var e=this;e.widget&&e.widget.getVolume(function(t){t>0?e.widget.setVolume(0):e.widget.setVolume(1)})}});return new i("body")});