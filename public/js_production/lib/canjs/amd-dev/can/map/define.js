/*!
 * CanJS - 2.1.2
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Mon, 16 Jun 2014 20:44:18 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/observe"],function(e){e.Map.helpers.define=function(t){var n=t.prototype.define;t.define&&e.dev.warn("The define property should be on the map's prototype properties, not the static properies."),t.defaultGenerators={};for(var r in n)"value"in n[r]&&(typeof n[r].value=="function"?t.defaultGenerators[r]=n[r].value:t.defaults[r]=n[r].value),typeof n[r].Value=="function"&&function(e){t.defaultGenerators[r]=function(){return new e}}(n[r].Value)};var t=e.Map.prototype._setupDefaults;e.Map.prototype._setupDefaults=function(){var e=t.call(this),n=this.constructor;for(var r in n.defaultGenerators)e[r]=n.defaultGenerators[r].call(this);return e};var n=e.Map.prototype,r=n.__set;n.__set=function(t,n,i,s,o){var u,a=function(n){clearTimeout(u);var r=o&&o.call(f,n);return r!==!1&&e.trigger(f,"error",[t,n],!0),!1},f=this,l=this.define&&this.define[t],c=l&&l.set,h=l&&l.get;if(c){e.batch.start();var p=!1,d=c.call(this,n,function(e){r.call(f,t,e,i,s,a),p=!0,clearTimeout(u)},a);if(h){e.batch.stop();return}if(d===undefined&&!p&&c.length>=2){u=setTimeout(function(){e.dev.warn('can/map/setter.js: Setter "'+t+'" did not return a value or call the setter callback.')},e.dev.warnTimeout),e.batch.stop();return}return p||r.call(f,t,c.length===0&&d===undefined?n:d,i,s,a),e.batch.stop(),this}return r.call(f,t,n,i,s,a),this};var i={date:function(e){var t=typeof e;return t==="string"?(e=Date.parse(e),isNaN(e)?null:new Date(e)):t==="number"?new Date(e):e},number:function(e){return+e},"boolean":function(e){return e==="false"||e==="0"||!e?!1:!0},"*":function(e){return e},string:function(e){return""+e}},s=n.__type;n.__type=function(e,t){var n=this.define&&this.define[t],r=n&&n.type,o=n&&n.Type,u=e;return typeof r=="string"&&(r=i[r]),r||o?(r&&(u=r.call(this,u,t)),o&&!(u instanceof o)&&(u=new o(u)),u):s.call(this,u,t)};var o=n._remove;n._remove=function(t,n){var r=this.define&&this.define[t]&&this.define[t].remove,i;if(r){e.batch.start(),i=r.call(this,n);if(i===!1){e.batch.stop();return}return i=o.call(this,t,n),e.batch.stop(),i}return o.call(this,t,n)};var u=n._setupComputes;n._setupComputes=function(t){u.apply(this,arguments);for(var n in this.define){var r=this.define[n],i=r.get;i&&(this[n]=e.compute.async(t[n],i,this),this._computedBindings[n]={count:0})}};var a=e.Map.helpers._serialize;e.Map.helpers._serialize=function(e,t,n){return f(e,t,n)};var f=function(e,t,n){var r=e.define&&e.define[t]&&e.define[t].serialize;if(r===undefined)return a.apply(this,arguments);if(r!==!1)return typeof r=="function"?r.call(e,n,t):a.apply(this,arguments)},l=n.serialize;return n.serialize=function(e){var t=l.apply(this,arguments);if(e)return t;var n,r;for(var i in this.define)i in t||(n=this.define&&this.define[i]&&this.define[i].serialize,n&&(r=f(this,i,this.attr(i)),r!==undefined&&(t[i]=r)));return t},e.Map});