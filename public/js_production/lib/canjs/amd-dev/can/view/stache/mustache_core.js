/*!
 * CanJS - 2.1.2
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Mon, 16 Jun 2014 20:44:18 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/view/stache/utils","can/view/stache/mustache_helpers","can/view/live","can/view/elements","can/view/scope","can/view/node_lists"],function(e,t,n,r,i,s,o){r=r||e.view.live,i=i||e.view.elements,s=s||e.view.Scope,o=o||e.view.nodeLists;var u=/((([^\s]+?=)?('.*?'|".*?"))|.*?)\s/g,a=/^(?:(?:('.*?'|".*?")|([0-9]+\.?[0-9]*|true|false|null|undefined))|(?:(.+?)=(?:(?:('.*?'|".*?")|([0-9]+\.?[0-9]*|true|false|null|undefined))|(.+))))$/,f=/(?:(?:^|(\r?)\n)(\s*)(\{\{([^\}]*)\}\}\}?)([^\S\n\r]*)($|\r?\n))|(\{\{([^\}]*)\}\}\}?)/g,l=function(e){return e&&typeof e.get=="string"},c=function(e,t,n,r){var i=document.createDocumentFragment();for(var s=0,o=e.length;s<o;s++)h(i,n.fn(t?e.attr(""+s):e[s],r));return i},h=function(e,t){t&&e.appendChild(typeof t=="string"?document.createTextNode(t):t)},p=function(e,t,n,r){var i="";for(var s=0,o=e.length;s<o;s++)i+=n.fn(t?e.attr(""+s):e[s],r);return i},d=function(t,n,r){var i=n.computeData(t,{isArgument:r,args:[n.attr("."),n]});return e.compute.temporarilyBind(i.compute),i},v=function(e,t){var n=d(e,t,!0);return n.compute.hasDependencies?n.compute:n.initialValue},m=function(e,t,n,r,i,s){i&&(e.fn=g(i,t,n,r)),s&&(e.inverse=g(s,t,n,r))},g=function(t,n,r,i){var s=function(e,r,i){return t(e||n,r,i)};return function(t,o,u){var a=e.__clearReading();t!==undefined&&!(t instanceof e.view.Scope)&&(t=n.add(t)),o!==undefined&&!(o instanceof y.Options)&&(o=r.add(o));var f=s(t,o||r,u||i);return e.__setReading(a),f}},y={expressionData:function(n){var r=[],i={},s=0;return(e.trim(n)+" ").replace(u,function(e,n){var o;s&&(o=n.match(a))?o[1]||o[2]?r.push(t.jsonParse(o[1]||o[2])):i[o[3]]=o[6]?{get:o[6]}:t.jsonParse(o[4]||o[5]):r.push({get:n}),s++}),{name:r.shift(),args:r,hash:i}},makeEvaluator:function(r,i,s,o,u,a,f,h){var g=[],y={},b={fn:function(){},inverse:function(){}},w=r.attr("."),E=u.name,S,x=u.args.length||!e.isEmptyObject(u.hash),T;for(var N=0,C=u.args.length;N<C;N++){var k=u.args[N];k&&l(k)?g.push(v(k.get,r,!0)):g.push(k)}for(var L in u.hash)l(u.hash[L])?y[L]=v(u.hash[L].get,r):y[L]=u.hash[L];if(l(E)){x&&(S=n.getHelper(E.get,i),!S&&typeof w[E.get]=="function"&&(S={fn:w[E.get]}));if(!S){var A=E.get,O=d(E.get,r,!1),M=O.compute;T=O.initialValue,O.reads&&O.reads.length===1&&O.root instanceof e.Map&&(M=e.compute(O.root,O.reads[0])),O.compute.hasDependencies?E=M:E=T,!x&&T===undefined?S=n.getHelper(A,i):typeof T=="function"&&(S={fn:T})}!S&&T===undefined&&(x?e.dev.warn('can/view/stache/mustache_core.js: Unable to find helper "'+u.name.get+'".'):e.dev.warn('can/view/stache/mustache_core.js: Unable to find key or helper "'+u.name.get+'".'))}if(o==="^"){var _=a;a=f,f=_}if(S)return m(b,r,i,s,a,f),e.simpleExtend(b,{context:w,scope:r,contexts:r,hash:y,nodeList:s}),g.push(b),function(){return S.fn.apply(w,g)||""};if(!o)return E&&E.isComputed?E:function(){return""+(E!=null?E:"")};if(o==="#"||o==="^")return m(b,r,i,s,a,f),function(){var n;e.isFunction(E)&&E.isComputed?n=E():n=E;if(t.isArrayLike(n)){var s=t.isObserveLike(n);return(s?n.attr("length"):n.length)?(h?p:c)(n,s,b,i):b.inverse(r,i)}return n?b.fn(n||r,i):b.inverse(r,i)}},makeLiveBindingPartialRenderer:function(t,n){return t=e.trim(t),function(r,s,u){var a=s.attr("partials."+t),f;a?f=a.render?a.render(r,s):a(r,s):f=e.view.render(t,r,s),f=e.frag(f);var l=[this];o.register(l,null,n.directlyNested?u||!0:!0),o.update(l,f.childNodes),i.replace([this],f)}},makeStringBranchRenderer:function(e,t){var n=w(t),r=e+t;return function(i,s,o,u){var a=i.__cache[r];if(e||!a)a=b(i,s,null,e,n,o,u,!0),e||(i.__cache[r]=a);var f=a();return f==null?"":""+f}},makeLiveBindingBranchRenderer:function(t,n,s){var u=w(n);return function(f,l,c,h,p){var d=[this];d.expression=n,o.register(d,null,s.directlyNested?c||!0:!0);var v=b(f,l,d,t,u,h,p,s.tag),m=e.compute(v,null,!1,!0);m.bind("change",e.k);var g=m();if(typeof g=="function"){var y=e.__clearReading();g(this),e.__setReading(y)}else m.hasDependencies?s.attr?r.simpleAttribute(this,s.attr,m):s.tag?r.attributes(this,m):s.text&&typeof g!="object"?r.text(this,m,this.parentNode,d):r.html(this,m,this.parentNode,d):s.attr?e.attr.set(this,s.attr,g):s.tag?r.setAttributes(this,g):s.text&&typeof g=="string"?this.nodeValue=g:g&&i.replace([this],e.frag(g));m.unbind("change",e.k)}},splitModeFromExpression:function(t,n){t=e.trim(t);var r=t[0];return"#/{&^>!".indexOf(r)>=0?t=e.trim(t.substr(1)):r=null,r==="{"&&n.node&&(r=null),{mode:r,expression:t}},cleanLineEndings:function(e){return e.replace(f,function(e,t,n,r,i,s,o,u,a,f){s=s||"",t=t||"",n=n||"";var l=E(i||a,{});return u||">{".indexOf(l.mode)>=0?e:"^#!/".indexOf(l.mode)>=0?r+(f!==0&&o.length?t+"\n":""):n+r+s+(n.length||f!==0?t+"\n":"")})},Options:e.view.Scope.extend({init:function(t,n){!t.helpers&&!t.partials&&!t.tags&&(t={helpers:t}),e.view.Scope.prototype.init.apply(this,arguments)}})},b=y.makeEvaluator,w=y.expressionData,E=y.splitModeFromExpression;return y});