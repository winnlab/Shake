/*!
 * CanJS - 2.1.2
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Mon, 16 Jun 2014 20:44:18 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/util/bind","can/util/batch"],function(e,t){var n=[];e.__read=function(e,t){n.push({});var r=e.call(t);return{value:r,observed:n.pop()}},e.__reading=function(e,t){n.length&&(n[n.length-1][e._cid+"|"+t]={obj:e,event:t+""})},e.__clearReading=function(){if(n.length){var e=n[n.length-1];return n[n.length-1]={},e}},e.__setReading=function(e){n.length&&(n[n.length-1]=e)},e.__addReading=function(t){n.length&&e.simpleExtend(n[n.length-1],t)};var r=function(t,n,r,s){var u=e.__read(t,n),a=u.observed;return i(r,a,s),o(r,s),u},i=function(e,t,n){for(var r in t)s(e,t,r,n)},s=function(e,t,n,r){if(e[n])delete e[n];else{var i=t[n];i.obj.bind(i.event,r)}},o=function(e,t){for(var n in e){var r=e[n];r.obj.unbind(r.event,t)}},u=function(t,n,r,i){n!==r&&e.batch.trigger(t,i?{type:"change",batchNum:i}:"change",[n,r])},a=function(t,n,i,s){var o,u,a;return{on:function(f){u||(u=function(e){if(t.bound&&(e.batchNum===undefined||e.batchNum!==a)){var s=o.value;o=r(n,i,o.observed,u),f(o.value,s,e.batchNum),a=a=e.batchNum}}),o=r(n,i,{},u),s(o.value),t.hasDependencies=!e.isEmptyObject(o.observed)},off:function(e){for(var t in o.observed){var n=o.observed[t];n.obj.unbind(n.event,u)}}}},f=function(t,n,i,s){var o,u,a,f;return{on:function(l){a||(a=function(e){if(t.bound&&(e.batchNum===undefined||e.batchNum!==f)){var r=n.call(i);l(r,u,e.batchNum),u=r,f=f=e.batchNum}}),o=r(n,i,{},a),u=o.value,s(o.value),t.hasDependencies=!e.isEmptyObject(o.observed)},off:function(e){for(var t in o.observed){var n=o.observed[t];n.obj.unbind(n.event,a)}}}},l=function(t){return t instanceof e.Map||t&&t.__get},c=function(){};e.compute=function(t,r,i,s){if(t&&t.isComputed)return t;var o,l=c,h=c,p,d=function(){return p},v=function(e){p=e},m=v,g=[],y=function(e,t,n){m(e),u(o,e,t,n)},b;for(var w=0,E=arguments.length;w<E;w++)g[w]=arguments[w];o=function(t){if(arguments.length){var i=p,s=v.call(r,t,i);return o.hasDependencies?d.call(r):(s===undefined?p=d.call(r):p=s,u(o,p,i),p)}return n.length&&o.canReadForChangeEvent!==!1&&(e.__reading(o,"change"),o.bound||e.compute.temporarilyBind(o)),o.bound?p:d.call(r)};if(typeof t=="function"){v=t,d=t,o.canReadForChangeEvent=i===!1?!1:!0;var S=s?f(o,t,r||this,m):a(o,t,r||this,m);l=S.on,h=S.off}else if(r)if(typeof r=="string"){var x=r,T=t instanceof e.Map;if(T){o.hasDependencies=!0;var N;d=function(){return t.attr(x)},v=function(e){t.attr(x,e)},l=function(n){N=function(e,t,r){n(t,r,e.batchNum)},t.bind(i||x,N),p=e.__read(d).value},h=function(e){t.unbind(i||x,N)}}else d=function(){return t[x]},v=function(e){t[x]=e},l=function(n){N=function(){n(d(),p)},e.bind.call(t,i||x,N),p=e.__read(d).value},h=function(n){e.unbind.call(t,i||x,N)}}else if(typeof r=="function")p=t,v=r,r=i,b="setter";else{p=t;var C=r,L=y;r=C.context||C,d=C.get||d,v=C.set||function(){return p};if(C.fn){var A=C.fn,O;d=function(){return A.call(r,p)},A.length===0?O=a(o,A,r,m):A.length===1?O=a(o,function(){return A.call(r,p)},r,m):(y=function(e){e!==undefined&&L(e,p)},O=a(o,function(){var e=A.call(r,p,function(e){L(e,p)});return e!==undefined?e:p},r,m)),l=O.on,h=O.off}else y=function(){var e=d.call(r);L(e,p)};l=C.on||l,h=C.off||h}else p=t;return e.cid(o,"compute"),e.simpleExtend(o,{isComputed:!0,_bindsetup:function(){this.bound=!0;var t=e.__clearReading();l.call(this,y),e.__setReading(t)},_bindteardown:function(){h.call(this,y),this.bound=!1},bind:e.bindAndSetup,unbind:e.unbindAndTeardown,clone:function(t){return t&&(b==="setter"?g[2]=t:g[1]=t),e.compute.apply(e,g)}})};var h,p=function(){for(var e=0,t=h.length;e<t;e++)h[e].unbind("change",c);h=null};return e.compute.temporarilyBind=function(e){e.bind("change",c),h||(h=[],setTimeout(p,10)),h.push(e)},e.compute.truthy=function(t){return e.compute(function(){var e=t();return typeof e=="function"&&(e=e()),!!e})},e.compute.async=function(t,n,r){return e.compute(t,{fn:n,context:r})},e.compute.read=function(t,n,r){r=r||{};var i=t,s,o,u;for(var a=0,f=n.length;a<f;a++){o=i,o&&o.isComputed&&(r.foundObservable&&r.foundObservable(o,a),o=o()),l(o)?(!u&&r.foundObservable&&r.foundObservable(o,a),u=1,typeof o[n[a]]=="function"&&o.constructor.prototype[n[a]]===o[n[a]]?r.returnObserveMethods?i=i[n[a]]:n[a]==="constructor"&&o instanceof e.Construct?i=o[n[a]]:i=o[n[a]].apply(o,r.args||[]):i=i.attr(n[a])):i=o[n[a]],s=typeof i,i&&i.isComputed&&!r.isArgument&&a<f-1?(!u&&r.foundObservable&&r.foundObservable(o,a+1),i=i()):a<n.length-1&&s==="function"&&r.executeAnonymousFunctions&&!(e.Construct&&i.prototype instanceof e.Construct)&&(i=i());if(a<n.length-1&&(i===null||s!=="function"&&s!=="object"))return r.earlyExit&&r.earlyExit(o,a,i),{value:undefined,parent:o}}return typeof i=="function"&&!(e.Construct&&i.prototype instanceof e.Construct)&&(r.isArgument?!i.isComputed&&r.proxyMethods!==!1&&(i=e.proxy(i,o)):(i.isComputed&&!u&&r.foundObservable&&r.foundObservable(i,a),i=i.call(o))),i===undefined&&r.earlyExit&&r.earlyExit(o,a-1),{value:i,parent:o}},e.compute});