/*!
 * CanJS - 2.1.2
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Mon, 16 Jun 2014 20:44:30 GMT
 * Licensed MIT
 * Includes: can/util/fixture
 * Download from: http://canjs.com
 */

(function(e){var t=function(t){var n=t.isArray;t.Object={};var r=t.Object.same=function(s,o,u,a,f,l){var c=typeof s,h=n(s),p=typeof u,d;if(p==="string"||u===null)u=i[u],p="function";if(p==="function")return u(s,o,a,f);u=u||{};if(s===null||o===null)return s===o;if(s instanceof Date||o instanceof Date)return s===o;if(l===-1)return c==="object"||s===o;if(c!==typeof o||h!==n(o))return!1;if(s===o)return!0;if(h){if(s.length!==o.length)return!1;for(var v=0;v<s.length;v++){d=u[v]===e?u["*"]:u[v];if(!r(s[v],o[v],s,o,d))return!1}return!0}if(c==="object"||c==="function"){var m=t.extend({},o);for(var g in s){d=u[g]===e?u["*"]:u[g];if(!r(s[g],o[g],d,s,o,l===!1?-1:e))return!1;delete m[g]}for(g in m)if(u[g]===e||!r(e,o[g],u[g],s,o,l===!1?-1:e))return!1;return!0}return!1};t.Object.subsets=function(e,n,r){var i=n.length,s=[];for(var o=0;o<i;o++){var u=n[o];t.Object.subset(e,u,r)&&s.push(u)}return s},t.Object.subset=function(e,t,n){n=n||{};for(var i in t)if(!r(e[i],t[i],n[i],e,t))return!1;return!0};var i={"null":function(){return!0},i:function(e,t){return(""+e).toLowerCase()===(""+t).toLowerCase()},eq:function(e,t){return e===t},similar:function(e,t){return e==t}};return i.eqeq=i.similar,t.Object}(window.can),n=function(t){if(!t.Object)throw new Error("can.fixture depends on can.Object. Please include it before can.fixture.");var n=function(e){return typeof steal!="undefined"?t.isFunction(steal.config)?steal.config().root.mapJoin(e).toString():steal.root.join(e).toString():(t.fixture.rootUrl||"")+e},r=function(e,r){if(!t.fixture.on)return;var i=function(){};e.type=e.type||e.method||"GET";var s=f(e);if(!e.fixture){window.location.protocol==="file:"&&i("ajax request to "+e.url+", no fixture found");return}typeof e.fixture=="string"&&t.fixture[e.fixture]&&(e.fixture=t.fixture[e.fixture]);if(typeof e.fixture=="string"){var o=e.fixture;/^\/\//.test(o)&&(o=n(e.fixture.substr(2))),s&&(o=t.sub(o,s)),delete e.fixture,e.url=o,e.data=null,e.type="GET",e.error||(e.error=function(e,t,n){throw"fixtures.js Error "+t+" "+n})}else e.dataTypes&&e.dataTypes.splice(0,0,"fixture"),s&&r&&(r.data=r.data||{},t.extend(r.data,s))},i=function(e,t,n,r){return typeof e!="number"&&(r=t,n=e,t="success",e=200),typeof t!="string"&&(r=n,n=t,t="success"),e>=400&&e<=599&&(this.dataType="text"),[e,t,s(this,n),r]},s=function(e,t){var n=e.dataTypes?e.dataTypes[0]:e.dataType||"json";if(!t||!t[n]){var r={};r[n]=t,t=r}return t};if(t.ajaxPrefilter&&t.ajaxTransport)t.ajaxPrefilter(r),t.ajaxTransport("fixture",function(n,r){n.dataTypes.shift();var o,u=!1;return{send:function(a,f){o=setTimeout(function(){var t=function(){u===!1&&f.apply(null,i.apply(n,arguments))},o=n.fixture(r,t,a,n);o!==e&&f(200,"success",s(n,o),{})},t.fixture.delay)},abort:function(){u=!0,clearTimeout(o)}}});else{var o=t.ajax;t.ajax=function(n){r(n,n);if(n.fixture){var s,u=new t.Deferred,a=!1;return u.getResponseHeader=function(){},u.then(n.success,n.fail),u.abort=function(){clearTimeout(s),a=!0,u.reject(u)},s=setTimeout(function(){var t=function(){var e=i.apply(n,arguments),t=e[0];(t>=200&&t<300||t===304)&&a===!1?u.resolve(e[2][n.dataType]):u.reject(u,"error",e[1])},r=n.fixture(n,t,n.headers,n);r!==e&&u.resolve(r)},t.fixture.delay),u}return o(n)}}var u=[],a=function(e,t){for(var n=0;n<u.length;n++)if(c._similar(e,u[n],t))return n;return-1},f=function(e){var t=a(e);if(t>-1)return e.fixture=u[t].fixture,c._getData(u[t].url,e.url)},l=function(t){var n=t.data.id;return n===e&&typeof t.data=="number"&&(n=t.data),n===e&&t.url.replace(/\/(\d+)(\/|$|\.)/g,function(e,t){n=t}),n===e&&(n=t.url.replace(/\/(\w+)(\/|$|\.)/g,function(e,t){t!=="update"&&(n=t)})),n===e&&(n=Math.round(Math.random()*1e3)),n},c=t.fixture=function(n,r){if(r!==e){if(typeof n=="string"){var i=n.match(/(GET|POST|PUT|DELETE) (.+)/i);i?n={url:i[2],type:i[1]}:n={url:n}}var s=a(n,!!r);s>-1&&u.splice(s,1);if(r==null)return;n.fixture=r,u.push(n)}else t.each(n,function(e,t){c(t,e)})},h=t.replacer;return t.extend(t.fixture,{_similar:function(e,n,r){return r?t.Object.same(e,n,{fixture:null}):t.Object.subset(e,n,t.fixture._compare)},_compare:{url:function(e,t){return!!c._getData(t,e)},fixture:null,type:"i"},_getData:function(e,n){var r=[],i=e.replace(".","\\.").replace("?","\\?"),s=(new RegExp(i.replace(h,function(e,t){return r.push(t),"([^/]+)"})+"$")).exec(n),o={};return s?(s.shift(),t.each(r,function(e){o[e]=s.shift()}),o):null},store:function(n,r,i){var s=0,o=function(e){for(var t=0;t<f.length;t++)if(e==f[t].id)return f[t]},u={},a,f,c;t.isArray(n)&&typeof n[0]=="string"?(a=n,n=r,r=i,i=arguments[3]):typeof n=="string"&&(a=[n+"s",n],n=r,r=i,i=arguments[3]);if(typeof n=="number")f=[],c=function(){f=[];for(var e=0;e<n;e++){var i=r(e,f);i.id||(i.id=e),s=Math.max(i.id+1,s+1)||f.length,f.push(i)}t.isArray(a)&&(t.fixture["~"+a[0]]=f,t.fixture["-"+a[0]]=u.findAll,t.fixture["-"+a[1]]=u.findOne,t.fixture["-"+a[1]+"Update"]=u.update,t.fixture["-"+a[1]+"Destroy"]=u.destroy,t.fixture["-"+a[1]+"Create"]=u.create)};else{i=r;var h=n;c=function(){f=h.slice(0)}}return t.extend(u,{findAll:function(n){n=n||{};var r=f.slice(0);n.data=n.data||{},t.each((n.data.order||[]).slice(0).reverse(),function(e){var t=e.split(" ");r=r.sort(function(e,n){return t[1].toUpperCase()!=="ASC"?e[t[0]]<n[t[0]]?1:e[t[0]]===n[t[0]]?0:-1:e[t[0]]<n[t[0]]?-1:e[t[0]]===n[t[0]]?0:1})}),t.each((n.data.group||[]).slice(0).reverse(),function(e){var t=e.split(" ");r=r.sort(function(e,n){return e[t[0]]>n[t[0]]})});var s=parseInt(n.data.offset,10)||0,o=parseInt(n.data.limit,10)||f.length-s,u=0;for(var a in n.data){u=0;if(n.data[a]!==e&&(a.indexOf("Id")!==-1||a.indexOf("_id")!==-1))while(u<r.length)n.data[a]!=r[u][a]?r.splice(u,1):u++}if(typeof i=="function"){u=0;while(u<r.length)i(r[u],n)?u++:r.splice(u,1)}else if(typeof i=="object"){u=0;while(u<r.length)t.Object.subset(r[u],n.data,i)?u++:r.splice(u,1)}return{count:r.length,limit:n.data.limit,offset:n.data.offset,data:r.slice(s,s+o)}},findOne:function(e,t){var n=o(l(e));if(typeof n=="undefined")return t(404,"Requested resource not found");t(n)},update:function(e,n){var r=l(e),i=o(r);if(typeof i=="undefined")return n(404,"Requested resource not found");t.extend(i,e.data),n({id:r},{location:e.url||"/"+l(e)})},destroy:function(e,t){var n=l(e),r=o(n);if(typeof r=="undefined")return t(404,"Requested resource not found");for(var i=0;i<f.length;i++)if(f[i].id==n){f.splice(i,1);break}return{}},create:function(e,n){var i=r(f.length,f);t.extend(i,e.data),i.id||(i.id=s++),f.push(i),n({id:i.id},{location:e.url+"/"+i.id})}}),c(),t.extend({getId:l,find:function(e){return o(l(e))},reset:c},u)},rand:function p(t,n,r){if(typeof t=="number")return typeof n=="number"?t+Math.floor(Math.random()*(n-t)):Math.floor(Math.random()*t);var i=p;if(n===e)return i(t,i(t.length+1));var s=[];t=t.slice(0),r||(r=n),r=n+Math.round(i(r-n));for(var o=0;o<r;o++)s.push(t.splice(i(t.length),1)[0]);return s},xhr:function(e){return t.extend({},{abort:t.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:t.noop,overrideMimeType:t.noop,readyState:4,responseText:"",responseXML:null,send:t.noop,setRequestHeader:t.noop,status:200,statusText:"OK"},e)},on:!0}),t.fixture.delay=200,t.fixture.rootUrl=n(""),t.fixture["-handleFunction"]=function(e){return typeof e.fixture=="string"&&t.fixture[e.fixture]&&(e.fixture=t.fixture[e.fixture]),typeof e.fixture=="function"?(setTimeout(function(){e.success&&e.success.apply(null,e.fixture(e,"success")),e.complete&&e.complete.apply(null,e.fixture(e,"complete"))},t.fixture.delay),!0):!1},t.fixture.overwrites=u,t.fixture.make=t.fixture.store,t.fixture}(window.can,e,t)})();