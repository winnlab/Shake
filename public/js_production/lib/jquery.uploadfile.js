/*!
 * jQuery Upload File Plugin
 * version: 2.0.7
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */

(function(e){var t={};t.fileapi=e("<input type='file'/>").get(0).files!==undefined,t.formdata=window.FormData!==undefined,e.fn.uploadFile=function(n){function u(t,n,r){r.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),e(this).css("border","2px solid #A5A5C7")}),r.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),r.on("drop",function(r){e(this).css("border","2px dotted #A5A5C7"),r.preventDefault(),t.errorLog.html("");var i=r.originalEvent.dataTransfer.files;l(n,t,i)}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),t.css("border","2px dotted #A5A5C7")}),e(document).on("drop",function(e){e.stopPropagation(),e.preventDefault(),t.css("border","2px dotted #A5A5C7")})}function a(e){var t="",n=e/1024;if(parseInt(n)>1024){var r=n/1024;t=r.toFixed(2)+" MB"}else t=n.toFixed(2)+" KB";return t}function f(t){var n=[];jQuery.type(t)=="string"?n=t.split("&"):n=e.param(t).split("&");var r=n.length,i=[],s,o;for(s=0;s<r;s++)n[s]=n[s].replace(/\+/g," "),o=n[s].split("="),i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return i}function l(t,n,r){for(var i=0;i<r.length;i++){if(!c(n,t,r[i].name)){t.showError&&e("<div><font color='red'><b>"+r[i].name+"</b> is not allowed. Allowed "+t.allowedTypes+"<br></div>").appendTo(n.errorLog);continue}if(t.maxFileSize!=-1&&r[i].size>t.maxFileSize){t.showError&&e("<div><font color='red'><b>"+r[i].name+"</b> is not allowed. Allowed Max size: "+a(t.maxFileSize)+"<br></div>").appendTo(n.errorLog);continue}var s=t,o=new FormData,u=t.fileName.replace("[]","");o.append(u,r[i]);var l=t.formData;if(l){var h=f(l);for(var v=0;v<h.length;v++)h[v]&&o.append(h[v][0],h[v][1])}s.fileData=o;var m=new p(n);m.filename.html(n.fileCounter+"). "+r[i].name);var g=e("<form style='display:none; position:absolute;left: 150px;' class='"+n.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");g.appendTo("body");var y=[];y.push(r[i].name),d(g,s,m,y,n),n.fileCounter++}}function c(e,t,n){var r=t.allowedTypes.toLowerCase().split(","),i=n.split(".").pop().toLowerCase();return t.allowedTypes!="*"&&jQuery.inArray(i,r)<0?!1:!0}function h(n,r,i,s){var o="ajax-upload-id-"+(new Date).getTime(),u=e("<form method='"+i.method+"' action='"+i.url+"' enctype='"+i.enctype+"'></form>"),a="<input type='file' id='"+o+"' name='"+i.fileName+"'/>";i.multiple&&(i.fileName.indexOf("[]")!=i.fileName.length-2&&(i.fileName+="[]"),a="<input type='file' id='"+o+"' name='"+i.fileName+"' multiple/>");var f=e(a).appendTo(u);f.change(function(){n.errorLog.html("");var o=i.allowedTypes.toLowerCase().split(","),a=[];if(this.files)for(g=0;g<this.files.length;g++)a.push(this.files[g].name);else{var f=e(this).val();a.push(f);if(!c(n,i,f)){i.showError&&e("<font color='red'><b>"+f+"</b> is not allowed. Allowed "+i.allowedTypes+"<br>").appendTo(n.errorLog);return}}s.unbind("click"),h(n,r,i,s),u.addClass(r);if(i.multiple&&t.formdata){u.removeClass(r);var v=this.files;l(i,n,v)}else{var m="";for(var g=0;g<a.length;g++)m+=n.fileCounter+"). "+a[g]+"<br>",n.fileCounter++;var y=new p(n);y.filename.html(m),d(u,i,y,a,n)}}),u.css({margin:0,padding:0,display:"block",position:"absolute",left:"-550px"}),u.appendTo("body"),navigator.appVersion.indexOf("MSIE ")!=-1?s.attr("for",o):s.click(function(){f.click()})}function p(t){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>"),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+t.formGroup+"'>Abort</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red'>Cancel</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>Done</div>").appendTo(this.statusbar).hide(),t.errorLog.before(this.statusbar),this}function d(e,n,r,i,s){var o=null,u={cache:!1,contentType:!1,processData:!1,forceSync:!1,data:n.formData,formData:n.fileData,dataType:n.returnType,beforeSubmit:function(e,t,r){var i=n.dynamicFormData();if(i){var s=f(i);if(s)for(var o=0;o<s.length;o++)s[o]&&(n.fileData!=undefined?r.formData.append(s[o][0],s[o][1]):r.data[s[o][0]]=s[o][1])}return!0},beforeSend:function(e,s){n.onSubmit.call(this,i,e),r.progressDiv.show(),r.cancel.hide(),r.done.hide(),n.showAbort&&(r.abort.show(),r.abort.click(function(){e.abort()})),t.formdata?r.progressbar.width("1%"):r.progressbar.width("5%")},uploadProgress:function(e,t,n,i){var s=i+"%";i>1&&r.progressbar.width(s)},success:function(t,o,u){s.responses.push(t),r.progressbar.width("100%"),r.abort.hide(),n.onSuccess.call(this,i,t,u),n.showStatusAfterSuccess?n.showDone?(r.done.show(),r.done.click(function(){r.statusbar.hide("slow"),r.statusbar.remove()})):r.done.hide():(r.statusbar.hide("slow"),r.statusbar.remove()),e.remove()},error:function(t,s,o){r.abort.hide(),t.statusText=="abort"?r.statusbar.hide("slow"):(n.onError.call(this,i,s,o),n.showStatusAfterError?(r.progressDiv.hide(),r.statusbar.append("<font color='red'>ERROR: "+o+"</font>")):(r.statusbar.hide(),r.statusbar.remove())),e.remove()}};n.autoSubmit?e.ajaxSubmit(u):(n.showCancel&&(r.cancel.show(),r.cancel.click(function(){e.remove(),r.statusbar.remove()})),e.ajaxForm(u))}var r=e.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,buttonCss:!1,buttonClass:!1,onSubmit:function(e,t){},onSuccess:function(e,t,n){},onError:function(e,t,n){},uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>"},n);this.fileCounter=1;var i="ajax-file-upload-"+(new Date).getTime();this.formGroup=i,this.hide(),this.errorLog=e("<div class='error_log'></div>"),this.after(this.errorLog),this.responses=[],t.formdata||(r.dragDrop=!1);var s=this,o=e('<label for="" >'+e(this).html()+"</label>");return e(o).addClass(r.uploadButtonClass),function v(){if(e.fn.ajaxForm){if(r.dragDrop){var t=e('<div class="ajax-upload-dragdrop"></div>');e(s).before(t),e(t).append(o),e(t).append(e(r.dragDropStr)),u(s,r,t)}else e(s).before(o);h(s,i,r,o)}else window.setTimeout(v,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(t,n){e(this).is("form")&&e(this).submit()})},this.stopUpload=function(){e(".ajax-file-upload-red").each(function(t,n){e(this).hasClass(s.formGroup)&&e(this).click()})},this.getResponses=function(){return this.responses},this}})(jQuery);